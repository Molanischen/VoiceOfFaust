
//-----------------------------------------------
// PAF vocoder synthesis
//-----------------------------------------------
maxNrInRoutings = 3;
//pafCenters=     par(i,nrBands,   pow((pow((pafTop/pafBottom),1/15)),i)*pafBottom);
pafCenters = centers(1,PAFvocoderGroup);

// pafIndexes = VocoderLinArray(pafIndexBottom,pafIndexTop);
pafIndexes  =PAFvocoderGroup(VocoderLinArrayChooser(pafIndexBottom,pafIndexMid,pafIndexBand,pafIndexTop,para));

pafOscs=
    interleave(nrBands,4):
    par(i, nrBands, paf);
    /*paf(pafCenter16,Fund,pafIndex,pafVol16)*/
/*with {*/
  /*routing =bus(nrBands)<:(*/
               /*(bus(nrBands):(par(i,nrBands,(inputRouting==0:dezip) *_)))*/
               /*,(interleave(nrBands/nrOutChan,nrOutChan):(par(i,nrBands,(inputRouting==1:dezip) *_)))*/
               /*,(butterfly(nrBands):(par(i,nrBands,(inputRouting==2:dezip) *_)))*/
               /*,(butterfly(nrBands):interleave(nrBands/nrOutChan,nrOutChan):(par(i,nrBands,(inputRouting==3:dezip) *_)))*/
               /*[>,(hademar:>par(i,nrOutChan, (inputRouting==2) *_))<]*/
             /*):>bus(nrBands);*/
           /*};*/



// PAFvocoder(audio,freq,index,fidelity,doubleOscs)
PAFvocoder(audio,freq,index,fidelity,0)=
  (pafCenters,(funds(freq,index,0,PAFvocoderGroup)),pafIndexes,analizer(voice(audio,index),freq,fidelity,enableDeEsser))
  :pafOscs
  :vocoderMixer(ambisonicsOn,outputRoutingEnabled,0)
  :postProc(nrOutChan,ambisonicsOn,enableAutosat,volume*0.25,width);


PAFvocoder(audio,freq,index,fidelity,1)=
  par(i,nrOutChan,
    (pafCenters,(funds(freq,index,i,PAFvocoderGroup)),pafIndexes,analizer(voice(audio,index),freq,fidelity,enableDeEsser))
    :pafOscs
  )
  :vocoderMixer(ambisonicsOn,outputRoutingEnabled,1)
  :postProc(nrOutChan,ambisonicsOn,enableAutosat,volume*0.25,width);
