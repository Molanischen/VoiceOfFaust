
//-----------------------------------------------
// FM vocoder synthesis
//-----------------------------------------------
maxNrInRoutings = 3;
//FMcenters=     par(i,nrBands,   pow((pow((pafTop/pafBottom),1/15)),i)*pafBottom);
FMcenters(freq) = VocoderFreqs(FMbottom,FMtop):par(i, nrBands, _*freq):dezipBands;

FMindexes = VocoderFreqs(FMindexBottom,FMindexTop):dezipBands;
// FMindexes = VocoderLinArray(FMindexBottom,FMindexTop);

import("lib/myFMvox.dsp");

FMoscs=
    interleave(nrBands,5):
    par(i, nrBands, fuphoSlave);



FMvocoder(audio,freq)=
  ((FMfund(freq)<:bus(nrBands)), (freq<:bus(nrBands)),analizer(voice(audio),freq),FMindexes,FMcenters(freq)):FMoscs:vocoderMixer(ambisonicsOn,outputRoutingEnabled)
           :postProc(nrOutChan,ambisonicsOn,volume*0.25,FMwidth);